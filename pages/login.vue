<template>
    <div class="flex items-center justify-center">
      <div class="max-w-md w-full space-y-8">
        <div class="text-center">
          <h1 class="text-4xl md:text-5xl font-mono font-bold bg-gradient-to-r from-blue-400 to-purple-500 bg-clip-text text-transparent mb-4">
            –í—Ö–æ–¥
          </h1>
          <p class="text-gray-400 text-lg">
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –∏–∑ Telegram –±–æ—Ç–∞
          </p>
        </div>

        <FormKit @submit="authUser" type="form" :actions="false" messages-class="hidden" form-class="border border-gray-700 rounded-2xl p-8 space-y-6">
          <FormKit validation="required" placeholder="user_123456" label="–õ–æ–≥–∏–Ω" name="login" type="text" messages-class="text-[#E9556D] font-mono" outer-class="w-full" input-class="w-full px-4 py-1.5 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"/>
          <FormKit validation="required|length:6" placeholder="¬∑¬∑¬∑¬∑¬∑¬∑" label="–ü–∞—Ä–æ–ª—å" name="password" type="password" messages-class="text-[#E9556D] font-mono" outer-class="w-full" input-class="w-full px-4 py-1.5 rounded-xl bg-gray-700 border border-gray-600 text-white placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"/>

          <button :disabled="isAuthDisabled" :class="{isAuthDisabled : 'opacity-70'}" type="submit" class="group relative w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white py-3 px-4 rounded-lg font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg hover:shadow-xl">
              <span class="group-hover:translate-x-1 transition-transform">üöÄ</span>
              <span>{{ isAuthDisabled ? '–í—Ö–æ–¥...' : '–í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É' }}</span>
          </button>
        </FormKit>
  
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –±–ª–æ–∫ -->
        <div class="bg-blue-500/10 border border-blue-500/20 rounded-xl p-6 space-y-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center">
              <span class="text-blue-400">üì±</span>
            </div>
            <div>
              <p class="text-blue-400 font-medium">–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø?</p>
              <p class="text-gray-400 text-sm">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ Telegram –±–æ—Ç–µ</p>
            </div>
          </div>
          
          <div class="space-y-2 text-sm text-gray-400">
            <div class="flex items-center gap-2">
              <div class="w-1.5 h-1.5 bg-blue-400 rounded-full"></div>
              <span>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Telegram –±–æ—Ç–∞</span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-1.5 h-1.5 bg-blue-400 rounded-full"></div>
              <span>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É <code class="bg-gray-700 px-2 py-1 rounded text-blue-300">/website</code></span>
            </div>
            <div class="flex items-center gap-2">
              <div class="w-1.5 h-1.5 bg-blue-400 rounded-full"></div>
              <span>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞</span>
            </div>
          </div>
        </div>
  
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ -->
        <div class="text-center space-y-4">
          <div class="flex items-center justify-center gap-3 text-gray-500">
            <div class="h-px bg-gray-700 flex-1"></div>
            <span class="text-sm">–∏–ª–∏</span>
            <div class="h-px bg-gray-700 flex-1"></div>
          </div>
  
          <NuxtLink 
            to="/" 
            class="inline-flex items-center gap-2 text-gray-400 hover:text-white transition-colors group"
          >
            <span class="group-hover:-translate-x-1 transition-transform">‚Üê</span>
            –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é
          </NuxtLink>
        </div>
      </div>
    </div>
  </template>
  
  <script setup>
/* –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —è–∑—ã–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
useSeoMeta({
    title: '–í—Ö–æ–¥',
    lang: 'ru'
})


/* —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏–ª–∏—â */
const { showMessage } = useMessagesStore()
const { login } = useUserStore()


/* –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ë–î –∏ —Ä–æ—É—Ç–µ—Ä–∞ */
const supabase = useSupabaseClient()
const router = useRouter()

/* –≤—Ö–æ–¥ */
const isAuthDisabled = ref(false)
const authUser = async(formData) => {      
    isAuthDisabled.value = true
    const { data: user, error } = await supabase
    .from('website_users')
    .select("*")
    .eq('login', formData.login)
    .single()

    if (!user) {
        formData.login = ""
        isAuthDisabled.value = false
        return showMessage("–ù–µ–≤–µ—Ä–Ω–æ –≤–≤–µ–¥–µ–Ω –ª–æ–≥–∏–Ω!", false)              
    }

    if (formData.password !== user.password) {
        formData.password = ""
        isAuthDisabled.value = false
        return showMessage('–ù–µ–≤–µ—Ä–Ω–æ –≤–≤–µ–¥–µ–Ω –ø–∞—Ä–æ–ª—å!', false)            
    }

    showMessage('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!', true)
    console.log('Login successful, user ID:', user.id, 'Type:', typeof user.id)
    login(user.id)
    isAuthDisabled.value = false
    // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ —á—Ç–æ–±—ã cookie —É—Å–ø–µ–ª —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
    await nextTick()
    router.push('/chat')
} 
  </script>